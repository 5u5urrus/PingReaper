# ICMP Redirect Check (`icmp_redirect_check`)

## Opening Scenario

During a penetration test of a financial institution, the red team discovers that certain endpoints blindly trust ICMP redirect messages. By sending a crafted redirect, the attackers silently reroute the target’s traffic through their own system — achieving a stealthy man-in-the-middle without touching the victim’s configuration.

## What This Test Is

ICMP Redirect messages (Type 5) are used by routers to tell a host that a better route exists for a given destination.
While legitimate in some legacy networking scenarios, they are **dangerous in untrusted environments** because they can be forged to alter traffic paths.

Common ICMP Redirect codes:

* **Code 0** – Redirect datagram for the network
* **Code 1** – Redirect datagram for the host
* **Code 2** – Redirect datagram for the Type of Service and network
* **Code 3** – Redirect datagram for the Type of Service and host

## Why This Matters

* Accepting forged ICMP redirects allows attackers to transparently intercept, modify, or drop traffic.
* This can enable credential theft, data exfiltration, or injection of malicious payloads without the victim’s knowledge.
* Many operating systems once trusted these messages by default — a legacy behavior still present in some poorly configured environments.

## How It Works

1. Attacker sends an ICMP Redirect packet to the victim, claiming that a different gateway is the “better” path.
2. If the victim accepts the message, it updates its routing table to send traffic via the attacker-controlled host.
3. From that point, the attacker can observe or manipulate the victim’s traffic before forwarding it on.

## Realistic Scenarios

1. **Corporate Network Pivot** – A compromised machine in the internal network sends forged redirects to nearby workstations, silently rerouting their internet-bound traffic through the attacker’s proxy for packet inspection and credential harvesting.

2. **Rogue Wi-Fi AP Attack** – An attacker sets up an open Wi-Fi hotspot in a coffee shop. Any connected device that accepts ICMP redirects will have its DNS and web traffic hijacked without triggering security alerts.

## Defensive Recommendations

* Disable ICMP redirect acceptance on all endpoints and servers.
* Filter ICMP Type 5 messages at network perimeters unless explicitly required.
* Use static routes in sensitive environments to prevent unauthorized routing changes.
* Monitor for unexpected route table modifications on endpoints.
